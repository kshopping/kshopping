<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì£¼ë¬¸ ì ‘ìˆ˜ ì™„ë£Œ / Order Received - K-Shopping</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background:#f7f7f7;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
      color:#222;
    }
    .card {
      background:#fff;
      border-radius:10px;
      max-width:900px;
      margin:20px auto;
      padding:16px;
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
    }
    h1 { font-size:22px; margin-bottom:6px; }
    h2 { font-size:18px; margin-bottom:8px; }
    h3 { font-size:16px; margin:14px 0 8px; }
    p  { font-size:13px; line-height:1.6; }

    table { width:100%; border-collapse:collapse; font-size:13px; }
    th, td {
      border-bottom:1px solid #eee;
      padding:4px 2px;
      text-align:left;
    }
    th { background:#fafafa; }
    .text-right { text-align:right; }

    .btn-primary {
      border:none; background:#222; color:#fff;
      padding:10px 16px; border-radius:999px; font-size:14px; cursor:pointer;
    }
    .btn-row { text-align:center; }

    .address-confirm-box {
      margin-top:8px;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid #ffd591;
      background:#fff7e6;
      font-size:13px;
      line-height:1.5;
    }
    .address-confirm-box b { display:block; margin-top:4px; }

    /* === Header === */
.ks-header {
  position: sticky;
  top: 0;
  z-index: 999;
  background-color: #ffffff;
  border-bottom: 1px solid #eee;
}
.ks-header-inner {
  max-width: 1200px;
  margin: 0 auto;
  padding: 10px 16px;
  display: flex;
  align-items: center;
  gap: 16px;
}
.ks-header-spacer { height: 64px; }

.ks-logo {
  display: flex;
  flex-direction: column;
  cursor: pointer;
  margin-right: 12px;
  white-space: nowrap;
}
.ks-logo-main {
  font-weight: 800;
  font-size: 22px;
  letter-spacing: 0.3px;
}
.ks-logo-sub {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.3px;
  color: #666;
}
.ks-logo-sub .kor {
  margin-right: 4px;
}
.ks-logo-sub .eng {
  font-size: 11px;
  background: linear-gradient(90deg, #ff4d4f, #ff9800);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 700;
}

.ks-actions {
  display: flex;
  align-items: center;
  gap: 14px;
}
.ks-icon-btn {
  border: none;
  background: transparent;
  font-size: 13px;
  cursor: pointer;
}
.ks-icon-btn .cart-label { color:#ff4d4f; font-weight:700; }

.cart-icon-wrapper {
  width: 38px; height: 38px;
  background: #ff4d4f; border-radius: 50%;
  display: flex; justify-content:center; align-items:center;
  cursor:pointer;
  position: relative;
}
.cart-icon-wrapper img { width: 19px; filter: invert(100%); }
.ks-cart-badge {
  position:absolute; top:-4px; right:-4px;
  background:#222; color:#fff;
  border-radius:999px; font-size:11px;
  min-width:18px; height:18px;
  display:flex; justify-content:center; align-items:center;
  visibility:hidden;
}
  </style>
</head>

<body>
<header class="ks-header">
  <div class="ks-header-inner">
    <div class="ks-logo" onclick="location.href='index.html'">
      <span class="ks-logo-main">K-Shopping</span>
      <span class="ks-logo-sub">
        <span class="kor">ì™¸êµ­ì¸ì„ ìœ„í•œ ì „ë¬¸ ì‡¼í•‘ëª°</span> /
        <span class="eng">Global Shopping for Foreigners</span>
      </span>
    </div>

    <div class="ks-actions">
      <button class="ks-icon-btn">
        <span onclick="goToAdmin()">ê´€ë¦¬ì / Admin</span>
        <span class="cart-label" onclick="goToCartPage()"> / ì¥ë°”êµ¬ë‹ˆ</span>
      </button>

      <div class="cart-icon-wrapper" onclick="goToCartPage()">
        <img src="https://cdn-icons-png.flaticon.com/512/34/34568.png">
        <span class="ks-cart-badge" id="headerCartCount">0</span>
      </div>
    </div>
  </div>
</header>
<div class="ks-header-spacer"></div>

<div class="card">
  <h1>ì£¼ë¬¸ ì ‘ìˆ˜ ì™„ë£Œ / Order Received</h1>
  <p>
    ì£¼ë¬¸ì´ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
    ì•„ë˜ ì£¼ë¬¸ ì •ë³´ì™€ ì…ê¸ˆ ê³„ì¢Œë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.<br><br>
    âš  <b>ê²°ì œëŠ” ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</b><br>
    ì…ê¸ˆ í™•ì¸ í›„ ìƒí’ˆì´ ë°œì†¡ë©ë‹ˆë‹¤.
  </p>
</div>

<div class="card" id="orderInfo"></div>

<div class="card">
  <h2>ì…ê¸ˆ ê³„ì¢Œ / Bank Information</h2>
  <p>
    ì€í–‰ / Bank : <b id="bankName">êµ­ë¯¼ì€í–‰ KB Bank</b><br>
    ê³„ì¢Œë²ˆí˜¸ / Account : <b id="bankNumber">000000-00-000000</b><br>
    ì˜ˆê¸ˆì£¼ / Holder : <b id="bankHolder">K-Shopping</b><br><br>
    <span id="bankExtra">ì…ê¸ˆìëª…ì€ ì£¼ë¬¸ìëª…ê³¼ ë™ì¼í•˜ê²Œ ë¶€íƒë“œë¦½ë‹ˆë‹¤.</span>
  </p>
</div>

<div class="card btn-row">
  <button class="btn-primary" onclick="location.href='index.html'">ê³„ì† ì‡¼í•‘í•˜ê¸°</button>
</div>

<!-- ğŸ”µ Supabase load -->
<script type="module">
import { supabase } from "./js/supabaseClient.js";

function goToCartPage(){ location.href="cart.html"; }
function goToAdmin(){
  const pw=prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸:");
  if(pw==="100101") location.href="admin.html";
}

function updateHeaderCartCount(){
  const saved = localStorage.getItem("cart");
  const cart = saved ? JSON.parse(saved) : [];
  const qty = cart.reduce((a,b)=>a+(b.qty||1),0);
  const el = document.getElementById("headerCartCount");
  el.textContent = qty;
  el.style.visibility = qty>0 ? "visible":"hidden";
}

function formatPrice(n){ return n.toLocaleString()+"ì›"; }

async function loadOrder(){
  const params = new URLSearchParams(location.search);
  const orderId = params.get("id");
  const box = document.getElementById("orderInfo");

  if(!orderId){
    box.innerHTML = "<p>ì£¼ë¬¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
    return;
  }

  const { data, error } = await supabase
    .from("orders")
    .select("*")
    .eq("id", orderId)
    .single();

  if(error || !data){
    box.innerHTML = "<p>ì£¼ë¬¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
    return;
  }

  let html = `
    <h2>ì£¼ë¬¸ ì •ë³´</h2>
    <p>ì£¼ë¬¸ë²ˆí˜¸: <b>${data.id}</b></p>
    <p>ì£¼ë¬¸ì¼ì‹œ: ${new Date(data.created_at).toLocaleString("ko-KR")}</p>
    <hr style="margin:10px 0;">
    <p>ì´ë¦„: ${data.name}</p>
    <p>ì—°ë½ì²˜: ${data.phone}</p>
    <p>ì£¼ì†Œ: ${data.address}</p>
  `;

  if(data.memo){
    html += `<p>ìš”ì²­ì‚¬í•­: ${data.memo}</p>`;
  }

  html += `
    <div class="address-confirm-box">
      ì•„ë˜ ì£¼ì†Œë¡œ ë°°ì†¡ë©ë‹ˆë‹¤.<br>
      <b>${data.address}</b>
    </div>
  `;

  let rows = "";
  data.items.forEach(item=>{
    const qty=item.qty||1;
    const price=item.priceSale || item.price;
    const line=qty*price;

    rows += `
      <tr>
        <td>${item.name}</td>
        <td class="text-right">${qty}</td>
        <td class="text-right">${formatPrice(price)}</td>
        <td class="text-right">${formatPrice(line)}</td>
      </tr>
    `;
  });

  html += `
    <h3>ì£¼ë¬¸ ìƒí’ˆ</h3>
    <table>
      <thead>
        <tr>
          <th>ìƒí’ˆëª…</th><th class="text-right">ìˆ˜ëŸ‰</th>
          <th class="text-right">ê°€ê²©</th><th class="text-right">ê¸ˆì•¡</th>
        </tr>
      </thead>
      <tbody>${rows}</tbody>
    </table>
    <p style="margin-top:8px;">
      ì´ ìˆ˜ëŸ‰: <b>${data.total_qty}</b><br>
      ìƒí’ˆ í•©ê³„: <b>${formatPrice(data.subtotal)}</b><br>
      ì´ ê²°ì œ ì˜ˆì • ê¸ˆì•¡: <b>${formatPrice(data.total)}</b>
    </p>
  `;

  box.innerHTML = html;
}

document.addEventListener("DOMContentLoaded", ()=>{
  updateHeaderCartCount();
  loadOrder();
});
</script>

</body>
</html>
