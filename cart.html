<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì£¼ë¬¸ ì§„í–‰ì¤‘ / Order in Progress - K-Shopping</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing:border-box; margin:0; padding:0; }
    body {
      background:#f7f7f7;
      font-family:system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color:#222;
    }
    main {
      max-width:900px;
      margin:0 auto;
      padding:16px;
    }
    h1 { font-size:22px; margin-bottom:8px; }
    .sub { font-size:13px; color:#777; margin-bottom:18px; }

    .card {
      background:#fff;
      border-radius:10px;
      padding:14px 16px;
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
      margin-bottom:16px;
    }
    .card-title { font-size:16px; font-weight:600; margin-bottom:6px; }
    .card-sub { font-size:12px; color:#777; margin-bottom:10px; }

    label { font-size:13px; display:block; margin:8px 0 4px; }
    input, textarea {
      width:100%;
      border:1px solid #ddd;
      border-radius:6px;
      padding:8px 10px;
      font-size:13px;
    }
    textarea { min-height:60px; resize:vertical; }

    .method-options label { margin-bottom:4px; cursor:pointer; }

    .btn-primary {
      border:none;
      background:#222;
      color:#fff;
      padding:10px 16px;
      border-radius:999px;
      font-size:14px;
      font-weight:600;
      cursor:pointer;
    }
    .btn-secondary {
      border:1px solid #ccc;
      background:#fff;
      color:#333;
      padding:8px 14px;
      border-radius:999px;
      font-size:13px;
      font-weight:500;
      cursor:pointer;
    }

    .btn-primary:hover { background:#000; }
    .btn-secondary:hover { background:#f5f5f5; }

    .btn-row {
      display:flex;
      justify-content:space-between;
      gap:8px;
    }

    table {
      width:100%;
      border-collapse:collapse;
      margin-top:8px;
      font-size:13px;
    }
    th, td {
      border-bottom:1px solid #eee;
      padding:4px 2px;
      text-align:left;
    }
    th { background:#fafafa; }
    .text-right { text-align:right; }

    .summary-footer {
      margin-top:8px;
      font-size:13px;
    }

    .cart-qty-btn {
      border:1px solid #ccc;
      background:#fff;
      color:#333;
      padding:2px 6px;
      border-radius:4px;
      font-size:11px;
      cursor:pointer;
    }
    .cart-qty-input {
      width:48px;
      padding:3px 4px;
      margin:0 2px;
      font-size:12px;
      text-align:right;
    }
    .cart-del-btn {
      border:none;
      background:#e74c3c;
      color:#fff;
      padding:4px 8px;
      border-radius:4px;
      font-size:11px;
      cursor:pointer;
    }

    @media (max-width:600px){
      .btn-row {
        display:flex;
        flex-direction:column-reverse;
        gap:8px;
      }
    }
  
/* === Header from index.html (Genie copy) === */
.ks-header {
  position: sticky;
  top: 0;
  z-index: 999;
  background-color: #ffffff;
  border-bottom: 1px solid #eee;
}
.ks-header-inner {
  max-width: 1200px;
  margin: 0 auto;
  padding: 10px 16px;
  display: flex;
  align-items: center;
  gap: 16px;
}
.ks-header-spacer { height: 64px; }

.ks-logo {
  display: flex;
  flex-direction: column;
  cursor: pointer;
  margin-right: 12px;
  white-space: nowrap;
}
.ks-logo-main {
  font-weight: 800;
  font-size: 22px;
  letter-spacing: 0.3px;
}
.ks-logo-sub {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.3px;
  color: #666;
}
.ks-logo-sub .kor {
  margin-right: 4px;
}
.ks-logo-sub .eng {
  font-size: 11px;
  background: linear-gradient(90deg, #ff4d4f, #ff9800);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 700;
}

.ks-nav {
  display: flex;
  align-items: center;
  gap: 8px;
  flex: 1;
  overflow-x: auto;
}

.ks-actions {
  display: flex;
  align-items: center;
  gap: 14px;
}
.ks-icon-btn {
  border: none;
  background: transparent;
  font-size: 13px;
  cursor: pointer;
  position: relative;
}
.ks-icon-btn .cart-label {
  font-weight: 700;
  color: #ff4d4f;
}

.cart-icon-wrapper {
  width: 38px;
  height: 38px;
  background: #ff4d4f;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  position: relative;
  transition: 0.15s;
}
.cart-icon-wrapper:hover {
  background: #e0242a;
  transform: translateY(-1px);
}
.cart-icon-wrapper img {
  width: 19px;
  filter: invert(100%);
}
.ks-cart-badge {
  position: absolute;
  top: -4px;
  right: -4px;
  min-width: 18px;
  height: 18px;
  border-radius: 999px;
  background-color: #222;
  color: #fff;
  font-size: 11px;
  display: flex;
  align-items: center;
  justify-content: center;
  visibility: hidden;
}

</style>
</head>

<body>
<header class="ks-header">
  <div class="ks-header-inner">
    <div class="ks-logo" onclick="location.href='index.html'">
      <span class="ks-logo-main">K-Shopping</span>
      <span class="ks-logo-sub">
        <span class="kor">ì™¸êµ­ì¸ì„ ìœ„í•œ ì „ë¬¸ ì‡¼í•‘ëª°</span> /
        <span class="eng">Global Shopping for Foreigners</span>
      </span>
    </div>

    <nav class="ks-nav"></nav>

   <div class="ks-actions">
  <button class="ks-icon-btn" type="button">
    <!-- ì´ ê¸€ì”¨ëŠ” ê´€ë¦¬ì ì´ë™ -->
    <span onclick="goToAdmin()">ê´€ë¦¬ì / Admin</span>
    <!-- ì´ ê¸€ì”¨ëŠ” ì¥ë°”êµ¬ë‹ˆ ì´ë™ -->
    <span class="cart-label" onclick="goToCartPage()"> / ì¥ë°”êµ¬ë‹ˆ</span>
  </button>

  <!-- ë™ê·¸ë€ ì•„ì´ì½˜ë„ ì¥ë°”êµ¬ë‹ˆë¡œ ì´ë™ -->
  <div class="cart-icon-wrapper" onclick="goToCartPage()">
    <img src="https://cdn-icons-png.flaticon.com/512/34/34568.png" alt="Cart" />
    <span class="ks-cart-badge" id="headerCartCount">0</span>
  </div>
</div>
 
  </div>
</header>
<div class="ks-header-spacer"></div>

<main>
  <h1>ì£¼ë¬¸ ì§„í–‰ì¤‘ / Order in Progress</h1>
  <p class="sub">
    ì•„ë˜ ì£¼ë¬¸ ë‚´ìš©ì„ í™•ì¸í•œ í›„, ì£¼ë¬¸ì ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.<br>
    Please review your order and fill in your information.
  </p>

  <!-- ì „í™” ì£¼ë¬¸ ì•ˆë‚´ ë°•ìŠ¤ -->
  <section class="card" style="padding:0; border:none; background:transparent; box-shadow:none;">
    <div style="
      background:#e3f0ff;
      border-left:5px solid #1e6fff;
      padding:14px 16px;
      border-radius:10px;
      font-size:14px;
      color:#333;
      line-height:1.5;
    ">
      <div style="font-weight:600; margin-bottom:6px;">í•œêµ­ì–´ê°€ ì–´ë ¤ìš°ë©´ ì „í™”ë¡œ ì£¼ë¬¸í•˜ì„¸ìš”.</div>
      <div style="color:#444;">
        If Korean is difficult, please order by phone.
      </div>
      <div style="margin-top:10px; font-size:20px; font-weight:700; color:#1e6fff;">
        ğŸ“ ê³ ê°ì„¼í„° / Customer Service : 010-8640-8732
      </div>
    </div>
  </section>

  <!-- ì£¼ë¬¸ ìš”ì•½ (ì¥ë°”êµ¬ë‹ˆ ì—­í• ) -->
  <section class="card">
    <div class="card-title">ì£¼ë¬¸ ìƒí’ˆ / Order Summary</div>
    <div id="orderSummaryArea" style="font-size:13px;"></div>
  </section>

  <!-- ì£¼ë¬¸ì ì •ë³´ í¼ -->
  <section class="card" id="methodForm">
    <div class="card-title">ì£¼ë¬¸ì ì •ë³´ / Customer Information</div>

    <label>ì´ë¦„ / Name (í•œêµ­ì–´ ë˜ëŠ” ì˜ì–´) *</label>
    <input id="name" placeholder="ì˜ˆ: ê¹€ë¯¼ìˆ˜ ë˜ëŠ” MINSU KIM" />

    <label>ì—°ë½ì²˜ / Phone (with country code) *</label>
    <input id="phone" placeholder="ì˜ˆ: 010-8640-8732 ë˜ëŠ” +82 10-8640-8732" />

    <label>ì£¼ì†Œ / Address *</label>
    <textarea id="address"
      placeholder="í•œêµ­ì–´ ë˜ëŠ” ì˜ì–´ë¡œ ë°°ì†¡ì§€ë¥¼ ì ì–´ì£¼ì„¸ìš”. / Please write your shipping address in Korean or English."></textarea>

    <label>ìš”ì²­ì‚¬í•­ / Request message (ì„ íƒ)</label>
    <textarea id="memo"
      placeholder="ë°°ì†¡ ì‹œ ìš”ì²­ì‚¬í•­ì´ë‚˜ ì¶”ê°€ ë©”ëª¨ë¥¼ ì ì–´ì£¼ì„¸ìš”. / Any requests or notes."></textarea>
  </section>

  <!-- ë²„íŠ¼ -->
  <section class="card">
    <div class="btn-row" style="display:flex;justify-content:space-between;gap:8px;">
      <button type="button" class="btn-secondary" onclick="location.href='index.html'">
        â† ê³„ì† ì‡¼í•‘í•˜ê¸° / Continue Shopping
      </button>
      <button type="button" class="btn-primary" onclick="submitOrder()">
        ì£¼ë¬¸ ì ‘ìˆ˜ / Submit Order
      </button>
    </div>
  </section>
</main>

<script>
  function calculateCartSummaryForHeader() {
    const cart = loadCart();
    const qty = cart.reduce((sum, it) => sum + (it.qty || 1), 0);
    return { qty };
  }

  function updateHeaderCartCount() {
    const badge = document.getElementById("headerCartCount");
    if (!badge) return;
    const { qty } = calculateCartSummaryForHeader();
    badge.textContent = qty;
    badge.style.visibility = qty > 0 ? "visible" : "hidden";
  }

  function goToCartPage() {
    location.href = "cart.html";
  }

  function goToAdmin() {
    const pw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
    if (pw === "10010") location.href = "admin.html";
    else if (pw !== null) alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
  }

  function loadCart() {
    try {
      const saved = localStorage.getItem("cart");
      return saved ? JSON.parse(saved) : [];
    } catch (e) {
      return [];
    }
  }

  function saveCart(cart) {
    localStorage.setItem("cart", JSON.stringify(cart));
  }

  function formatPrice(num) {
    return num.toLocaleString("ko-KR") + "ì›";
  }

  function changeCartQty(index, delta) {
    const cart = loadCart();
    if (!cart[index]) return;
    let qty = (cart[index].qty || 1) + delta;
    if (qty < 1) qty = 1;
    cart[index].qty = qty;
    saveCart(cart);
    renderOrderSummary();
  }

  function setCartQty(index, value) {
    const cart = loadCart();
    if (!cart[index]) return;
    let qty = parseInt(value, 10);
    if (isNaN(qty) || qty < 1) qty = 1;
    cart[index].qty = qty;
    saveCart(cart);
    renderOrderSummary();
  }

  function removeCartItem(index) {
    const cart = loadCart();
    if (!cart[index]) return;
    cart.splice(index, 1);
    saveCart(cart);
    renderOrderSummary();
  }

  function renderOrderSummary() {
    const cart = loadCart();
    const area = document.getElementById("orderSummaryArea");

    if (!cart || cart.length === 0) {
      area.innerHTML = `
        <p style="color:#777;">
          ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸´ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ìƒí’ˆì„ ë‹´ì•„ ì£¼ì„¸ìš”.<br>
          Your cart is empty. Please add items first.
        </p>
      `;
      return;
    }

    let rows = "";
    let totalQty = 0;
    let subtotal = 0;

    cart.forEach((item, index) => {
      const qty   = item.qty || 1;
      const price = item.priceSale || item.price || 0;
      const line  = qty * price;
      totalQty   += qty;
      subtotal   += line;

      rows += `
        <tr>
          <td>${item.name}</td>
          <td class="text-right">
            <button type="button" class="cart-qty-btn" onclick="changeCartQty(${index}, -1)">-</button>
            <input type="number"
                   class="cart-qty-input"
                   min="1"
                   value="${qty}"
                   onchange="setCartQty(${index}, this.value)" />
            <button type="button" class="cart-qty-btn" onclick="changeCartQty(${index}, 1)">+</button>
          </td>
          <td class="text-right">${formatPrice(price)}</td>
          <td class="text-right">${formatPrice(line)}</td>
          <td class="text-right">
            <button type="button" class="cart-del-btn" onclick="removeCartItem(${index})">ì‚­ì œ</button>
          </td>
        </tr>
      `;
    });

    let shipping = 0;
    const totalAmount = subtotal + shipping;

    area.innerHTML = `
      <table>
        <thead>
          <tr>
            <th>ìƒí’ˆëª… / Product</th>
            <th class="text-right">ìˆ˜ëŸ‰ / Qty</th>
            <th class="text-right">ë‹¨ê°€ / Price</th>
            <th class="text-right">ê¸ˆì•¡ / Amount</th>
            <th class="text-right">ì‚­ì œ / Remove</th>
          </tr>
        </thead>
        <tbody>
          ${rows}
        </tbody>
      </table>

      <div class="summary-footer">
        ì´ ìˆ˜ëŸ‰ / Total Qty: <b>${totalQty}</b><br>
        ìƒí’ˆ í•©ê³„ / Subtotal: <b>${formatPrice(subtotal)}</b><br>
        ë°°ì†¡ë¹„ / Shipping: <b>${shipping === 0 ? "0ì› (ë˜ëŠ” ë¬´ë£Œ)" : formatPrice(shipping)}</b><br>
        ì´ ê²°ì œ ì˜ˆì • ê¸ˆì•¡ / Total amount: <b>${formatPrice(totalAmount)}</b>
      </div>
    `;
  }

  function submitOrder() {
    const cart = loadCart();
    if (!cart || cart.length === 0) {
      alert("ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.");
      return;
    }

    const now = new Date();
    const orderId = "KS" + now.getTime();

    let totalQty = 0;
    let subtotal = 0;
    cart.forEach(item => {
      const qty   = item.qty || 1;
      const price = item.priceSale || item.price || 0;
      totalQty += qty;
      subtotal += qty * price;
    });

    let shipping = 0;
    const totalAmount = subtotal + shipping;

    const name    = document.getElementById("name").value.trim();
    const phone   = document.getElementById("phone").value.trim();
    const address = document.getElementById("address").value.trim();
    const memo    = document.getElementById("memo").value.trim();

    if (!name)    { alert("ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”."); return; }
    if (!phone)   { alert("ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”."); return; }
    if (!address) { alert("ì£¼ì†Œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”."); return; }

    const order = {
      id: orderId,
      date: now.toISOString(),
      method: "form",
      name,
      phone,
      address,
      memo,
      cart,
      totalQty,
      subtotal,
      shipping,
      totalAmount
    };

    localStorage.setItem("lastOrder", JSON.stringify(order));

    const saved = localStorage.getItem("orders");
    let orders = saved ? JSON.parse(saved) : [];
    if (!Array.isArray(orders)) orders = [];
    orders.push(order);
    localStorage.setItem("orders", JSON.stringify(orders));

    localStorage.removeItem("cart");
    location.href = "order_complete.html";
  }

  document.addEventListener("DOMContentLoaded", () => {
    updateHeaderCartCount();
    renderOrderSummary();
    // í˜„ì¬ëŠ” í¼ ì…ë ¥ ë°©ì‹ë§Œ ì‚¬ìš© (ì „í™” ì£¼ë¬¸ ìš”ì²­ ë°©ì‹ì€ í–¥í›„ í•„ìš” ì‹œ êµ¬í˜„)
  });
</script>
</body>
</html>
